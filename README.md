# üöÄ InfraFlux

**InfraFlux** is an **opinionated, fully-automated, multi-cloud Kubernetes platform** inspired by
[ElfHosted](https://elfhosted.com) and the [Geek Cookbook Premix](https://geek-cookbook.funkypenguin.co.nz/).
It fast-tracks the deployment of complete "recipes" (curated Kubernetes app bundles) on clusters
running in **AWS, Azure, GCP, or Proxmox**‚Äîall driven by declarative manifests and GitOps.

> **Goal:** One command from zero to a production-ready Kubernetes cluster with curated apps, anywhere.

---

## ‚ú® Key Features

- **Multi-Cloud + Proxmox support** via [Cluster API (CAPI)](https://cluster-api.sigs.k8s.io/):
  - AWS (CAPA)
  - Azure (CAPZ)
  - GCP (CAPG)
  - Proxmox (CAPMOX)
- **Immutable OS** with [Talos Linux](https://www.talos.dev/) for deterministic, API-driven node configuration.
- **Unified networking** with [Cilium](https://cilium.io/) using kube-proxy replacement for low latency and minimal overhead.
- **GitOps app delivery** via [FluxCD](https://fluxcd.io/) syncing curated "recipes."
- **Optional cloud infra management** with [Crossplane](https://crossplane.io/)‚Äîprovision cloud databases, DNS, and storage from Kubernetes CRDs.
- **Batteries included**: cert-manager, ExternalDNS, Gateway API + Envoy Gateway, CSI storage.

---

## üìÇ Repository Structure

```filesystem
infraflux/
‚îú‚îÄ cli/ # Minimal Go CLI for init, up, destroy
‚îÇ ‚îî‚îÄ cmd/
‚îÇ
‚îú‚îÄ management/ # Management cluster configs
‚îÇ ‚îú‚îÄ clusterctl/ # clusterctl provider components
‚îÇ ‚îú‚îÄ talos/ # Talos machineconfigs for mgmt cluster
‚îÇ ‚îî‚îÄ flux/ # Flux bootstrap manifests
‚îÇ
‚îú‚îÄ clusters/ # Workload cluster definitions
‚îÇ ‚îú‚îÄ templates/ # Base CAPI + Talos YAML templates
‚îÇ ‚îú‚îÄ aws/
‚îÇ ‚îú‚îÄ azure/
‚îÇ ‚îú‚îÄ gcp/
‚îÇ ‚îú‚îÄ proxmox/
‚îÇ ‚îú‚îÄ cilium/helmrelease.yaml # Cilium install (kube-proxy replacement)
‚îÇ ‚îî‚îÄ gateway # Gateway API + Envoy Gateway manifests
‚îÇ
‚îú‚îÄ recipes/ # App stacks delivered via Flux
‚îÇ ‚îú‚îÄ base/ # Core infra: cert-manager, ExternalDNS, storage
‚îÇ ‚îú‚îÄ observability/ # Monitoring/logging stack
‚îÇ ‚îú‚îÄ media/ # Media processing stack (placeholder)
‚îÇ ‚îî‚îÄ devtools/ # Developer tools stack
‚îÇ
‚îú‚îÄ crossplane/ # Crossplane providers, compositions, claims
‚îÇ ‚îú‚îÄ base/
‚îÇ ‚îî‚îÄ compositions/
‚îÇ
‚îî‚îÄ sops/ # SOPS/age key management for secrets
```

> Note: The `site/` directory is generated by MkDocs and is excluded from version control and analysis.

---

## üõ†Ô∏è Workflow Overview

1. **Management Cluster Init**

   - Create a small Talos management cluster (anywhere).
   - Install CAPI + desired infrastructure providers (aws, azure, gcp, proxmox).
   - Bootstrap FluxCD pointing at this repo.

2. **Workload Cluster Creation**

   - Apply CAPI manifests for desired provider from `/clusters/<provider>/`.
   - Nodes boot via Talos machineconfigs.
   - Cilium installed with kube-proxy replacement.
   - Gateway API + Envoy Gateway configured.

3. **Recipe Deployment**

   - Recipes are Flux Kustomizations/HelmReleases in `/recipes/`.
   - Commit desired recipe configs ‚Üí Flux applies automatically.
   - cert-manager + ExternalDNS handle TLS/DNS automation.

4. **(Optional) Infra Resources**
   - Crossplane providers manage DBs, buckets, DNS zones declaratively.

---

## üöß Development Roadmap

- [x] CLI scaffolding (`infraflux`) with `init`, `up`, and `destroy` commands.
- [x] Management cluster Talos + CAPI bootstrapping manifests.
- [x] Provider overlays for AWS, Azure, GCP, Proxmox.
- [x] Cilium HelmRelease with kube-proxy replacement enabled.
- [x] Gateway API + Envoy Gateway setup.
- [x] Flux recipe catalog (base, observability, media, devtools).
- [x] Crossplane base installation & common compositions.
- [x] SOPS integration for secrets in Git.

---

## üß∞ Dev setup

- Optional but recommended: enable local git hooks so tests and YAML checks run on commit.

```bash
git config core.hooksPath githooks
```

---

## üìé Notes for Contributors

- `site/` is generated; do not edit or commit. It is excluded via `.gitignore` and Sonar exclusions.
- Run a local build to verify the CLI compiles:

```bash
make build-cli
./bin/infraflux --help
```

---

## üìú License

MIT License ¬© 2025 InfraFlux Contributors

---

## üôå Acknowledgements

- [ElfHosted](https://elfhosted.com) for inspiration in simplicity and automation.
- [Geek Cookbook](https://geek-cookbook.funkypenguin.co.nz/) for the recipe concept.
- [Talos Linux](https://www.talos.dev/) for making immutable Kubernetes nodes easy.
- [Cluster API](https://cluster-api.sigs.k8s.io/) for multi-cloud lifecycle management.
- [Cilium](https://cilium.io/) for networking done right.
- [FluxCD](https://fluxcd.io/) for GitOps that just works.
