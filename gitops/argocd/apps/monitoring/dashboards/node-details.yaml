apiVersion: v1
kind: ConfigMap
metadata:
  name: infraflux-node-details-dashboard
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
data:
  node-details.json: |
    {
      "dashboard": {
        "id": null,
        "title": "InfraFlux - Node Details",
        "tags": ["infraflux", "kubernetes", "nodes"],
        "timezone": "browser",
        "templating": {
          "list": [
            {
              "name": "node",
              "type": "query",
              "query": "label_values(kube_node_info, node)",
              "refresh": 1
            }
          ]
        },
        "panels": [
          {
            "id": 1,
            "title": "Node Information",
            "type": "table",
            "targets": [
              {
                "expr": "kube_node_info{node=\"$node\"}",
                "legendFormat": "Node Info"
              }
            ],
            "gridPos": {"h": 6, "w": 24, "x": 0, "y": 0}
          },
          {
            "id": 2,
            "title": "CPU Usage",
            "type": "graph",
            "targets": [
              {
                "expr": "100 - (avg(irate(node_cpu_seconds_total{instance=~\"$node.*\",mode=\"idle\"}[5m])) * 100)",
                "legendFormat": "CPU Usage %"
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 6}
          },
          {
            "id": 3,
            "title": "Memory Usage",
            "type": "graph",
            "targets": [
              {
                "expr": "node_memory_MemTotal_bytes{instance=~\"$node.*\"}",
                "legendFormat": "Total Memory"
              },
              {
                "expr": "node_memory_MemAvailable_bytes{instance=~\"$node.*\"}",
                "legendFormat": "Available Memory"
              },
              {
                "expr": "node_memory_MemTotal_bytes{instance=~\"$node.*\"} - node_memory_MemAvailable_bytes{instance=~\"$node.*\"}",
                "legendFormat": "Used Memory"
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 6}
          },
          {
            "id": 4,
            "title": "Disk Usage",
            "type": "graph",
            "targets": [
              {
                "expr": "node_filesystem_size_bytes{instance=~\"$node.*\",fstype!=\"tmpfs\"}",
                "legendFormat": "{{ mountpoint }} Total"
              },
              {
                "expr": "node_filesystem_avail_bytes{instance=~\"$node.*\",fstype!=\"tmpfs\"}",
                "legendFormat": "{{ mountpoint }} Available"
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 14}
          },
          {
            "id": 5,
            "title": "Network Traffic",
            "type": "graph",
            "targets": [
              {
                "expr": "irate(node_network_receive_bytes_total{instance=~\"$node.*\",device!=\"lo\"}[5m])",
                "legendFormat": "{{ device }} RX"
              },
              {
                "expr": "irate(node_network_transmit_bytes_total{instance=~\"$node.*\",device!=\"lo\"}[5m])",
                "legendFormat": "{{ device }} TX"
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 14}
          },
          {
            "id": 6,
            "title": "Load Average",
            "type": "graph",
            "targets": [
              {
                "expr": "node_load1{instance=~\"$node.*\"}",
                "legendFormat": "1m Load"
              },
              {
                "expr": "node_load5{instance=~\"$node.*\"}",
                "legendFormat": "5m Load"
              },
              {
                "expr": "node_load15{instance=~\"$node.*\"}",
                "legendFormat": "15m Load"
              }
            ],
            "gridPos": {"h": 8, "w": 24, "x": 0, "y": 22}
          }
        ],
        "time": {"from": "now-1h", "to": "now"},
        "refresh": "30s"
      }
    }
